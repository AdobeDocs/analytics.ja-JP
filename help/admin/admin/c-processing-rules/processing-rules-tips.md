---
description: ここでは、処理ルールのテストに関するガイドラインと、回避する必要がある一般的な間違いについて説明します。
subtopic: Processing rules
title: 処理ルールのヒントとテクニック
feature: Processing Rules
exl-id: e663d98b-dcfd-4420-84ac-07ddfe55a3f2
source-git-commit: 65ee7ae6d838f34149eb60547d976856e4da3b17
workflow-type: ht
source-wordcount: '615'
ht-degree: 100%

---

# 処理ルールのヒントとテクニック

ここでは、処理ルールのテストに関するガイドラインと、回避する必要がある一般的な間違いについて説明します。

## 処理ルールのテスト {#section_F092D2FECDE24082AE9FC6F8BE87F29F}

ここでは、処理ルールを実稼働環境に導入する前に行うテストで役立つガイドラインをいくつか説明します。

**検索用語を読み取るルールのテスト**

prop1 に「news」が含まれる場合などの条件に基づく検索では、prop1 レポートを開き、「news」を検索して、予期していなかった一致があるかどうかを確認します。

**変数を読み取るルールのテスト**

デスクトップに空の HTML ページを作成し、サイトの s_code を含めて、`s.account` 変数を開発レポートスイートに設定します。ルールがリファラーや参照ドメインなどに基づいている場合、実際に使用しているリファラーレポートの URL をいくつかサンプルとして利用し、その値のいずれかを `s.referrer` 変数に設定して、ページを読み込みます。同様に、ルールがページ URL 値に基づいている場合、`s.pageURL` を設定できます。これと同じプロセスを、すべての変数に使用できます。

**開発レポートスイートの使用**

開発レポートスイートに処理ルールを設定して、これらのルールが正しく動作していることを確認することをお勧めします。可能であれば、幅広く導入する前に、ルールを小規模な実稼動用レポートスイートにコピーしてください。

## 空の値の確認 {#section_EE84A5525E26415787930723B0CAAE0F}

ルールを作成するときは、値が空の場合を考慮します。空の値を確認する条件を追加しないと、誤って変数を空の値で上書きする可能性があります。

![](assets/tips-set-value-acquisition-code.png)

また、処理順を考慮することも重要です。次の例では、Page Name がない場合、カスタム eVar の Previous Pagename は URL に設定されます。ただし、処理ルールが適用された後でページ名に URL が設定されても、Page Name がページ上で設定されていなければ、Page Name は空になります。

![](assets/tips-copy-page-name-to-evar.png)

## 値の上書きの回避 {#section_49FCCA31E31A433EA2EF5EAF91443DAF}

次の例では、2 つのコンテキストデータ変数がサイトで使用され、search_keyword と search_term という検索用語が取得されます。ただし、設定に基づいて、search_term が空であっても、search_keyword 値は常に上書きされます。

内部検索用語を入力する前に、値の各コンテキストデータ変数をテストするように、このルールを設定しなおす必要があります。また、必要に応じて、2 つの値を維持する使用事例がある場合、それらの値を連結します。

![](assets/tips-search-keyword.png)

## 検索用語の UTF-8 または Unicode へのエンコード {#section_3BBBE1FB8FEA48589362452DE51DB575}

クエリ文字列から取得した検索用語は正しくエンコードする必要があります。そうしないと、処理ルールと一致しなくなります。

![](assets/tips-multibyte.png)

## 「次で始まる」、「次を含む」、「次で終わる」 {#section_80CE853244FC435B844A09EA51868D8D}

正しい照合条件を選択して、正確に照合を行う最も厳密な条件を見つけます。ルールを作成する前にレポート内の値を検索して、意図しない一致がないことを確認します。例えば、prop2 レポートを検索して、この条件が一致する場所をすべて見つけてから、このルールを有効にします。

![](assets/tips-startswith.png)

## VISTA を使用してヒットをコピーするときに処理ルールを適用する方法

他のレポートスイートにヒットをコピーするように VISTA ルールが設定されている場合、ヒットは、他のレポートスイートに定義されている処理ルールを介して送信されます。

元のレポートスイートで処理ルールが定義されている場合、エンジニアリングサービスが VISTA ルールをどのように設定したかに応じて、これらのルールの適用の有無が決まります。確認するには、VISTA ルールで「pre」または「post」値を追加のレポートスイートにコピーしたかどうかを導入担当者に問い合わせてください。「pre」値をコピーした場合、元のレポートスイートに定義されている処理ルールは適用されません。「post」値をコピーした場合、処理ルールが適用された後にヒットがコピーされます。
